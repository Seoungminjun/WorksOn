<!DOCTYPE html>
<html
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layout/default}">
<head>
    <title>내 근태 현황</title>
</head>
<style layout:fragment="style"></style>

<div layout:fragment="content">
    <!DOCTYPE html>
    <html lang="ko" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
            .home-content {
                display: flex;
            }

            #home-left {
                width: 250px;
                height: 300px;
                padding-left: 20px;
            }

            #home-my-tbl {
                width: 100%;
                background-color: white;
                border-radius: 8px;
                border: 1px solid #ccc;
                padding: 20px;
                box-sizing: border-box;
            }

            #clock {
                font-size: 40px;
                padding: 3px 0;
                color: black;
            }

            .img {
                width: 100px;
                height: 100px;
                border-radius: 50%;
            }

            .btn-tr {
                height: 50px;
            }

            .btn-tr button,
            select {
                border: 1px solid #00b6c2;
                color: #00b6c2;
                padding: 5px 15px;
                border-radius: 4px;
                cursor: pointer;
            }

            .font-bold {
                font-weight: bold;
            }

            .text-right {
                text-align: right;
            }
            #attendOnTime {
                outline: none;
            }
        </style>
    </head>
    <body>
    <div class="home-content">
        <!-- 본문 왼쪽 -->
        <div id="home-left" class="div-padding div-margin">
            <div style="height: 50px;"></div>
            <table id="home-my-tbl">
                <tbody>
                <tr>
                    <td id="year" colspan="2" class="font-14">clock</td>
                </tr>
                <tr>
                    <td colspan="2" id="clock" style="color:black;">clock</td>
                </tr>
                <tr>
                    <td colspan="2">
<!--                        <img th:src="${!empty session.loginMember.attachment} ? ${pageContext.request.contextPath}/resources/upload/emp/${session.loginMember.attachment.renameFilename} : ${pageContext.request.contextPath}/resources/images/default.png" alt="프로필 이미지" class="img">-->
                    </td>
                </tr>
                <tr>
<!--                    <td colspan="2" th:text="${session.loginMember.name + ' ' + session.loginMember.jobTitle}"></td>-->
                </tr>
                <tr>
<!--                    <td colspan="2" th:text="${session.loginMember.deptTitle}"></td>-->
                </tr>
                <tr>
                    <td class="font-14 font-bold">업무상태
                    <td class="text-right font-14 color-red font-bold" id="work-state"
                        th:text="${(attend.state == T(com.sh.workson.attend.entity.State).LATE || attend.state == T(com.sh.workson.attend.entity.State).WORK) ? '업무중' : (attend.state == T(com.sh.workson.attend.entity.State).QUIT ? '퇴근' : '')}"
                    ></td>
                    <!--                        th:text="${attend.state.getDisplayName()}"-->

                </tr>
                <tr>
                    <td class="font-14 font-bold">출근시간</td>
                    <td class="text-right font-14" id="startwork-time" th:text="${#temporals.format(attend.startAt,'HH:mm:ss')}"></td>
                </tr>

                <tr>
                    <td class="font-14 font-bold">퇴근시간</td>
                    <td class="text-right font-14" id="endwork-time" th:text="${#temporals.format(attend.endAt,'HH:mm:ss')}"></td>
                </tr>
                <tr class="btn-tr">
                    <td><button class="font-bold" id="btn-startwork" th:data-emp-id="${attend.employee.id}">출근하기</button></td>
                    <input id="attend-startAt" th:value="${attend.startAt}" type="hidden">
                    <script th:if="${attend.startAt != null}">
                        const attend = document.querySelector("#attend-startAt");
                        console.log(attend.value);
                        const startDay = attend.value.split("T")[0];
                        console.log(startDay);

                        const workState = document.querySelector("#work-state");
                        const start = document.querySelector("#startwork-time");
                        const end = document.querySelector("#endwork-time");

                        const currentDate = new Date();
                        const year = currentDate.getFullYear();
                        const month = (currentDate.getMonth() + 1).toString().padStart(2, '0');
                        const day = currentDate.getDate().toString().padStart(2, '0');
                        const formattedDate = `${year}-${month}-${day}`;
                        let isAttendRegistered = false;
                        console.log(formattedDate);

                        if (startDay === formattedDate){
                            isAttendRegistered = true;
                        } else{
                            workState.innerHTML = '';
                            start.innerHTML = '';
                            end.innerHTML = '';
                            isAttendRegistered = false;
                        }



                    </script>
                    <td class="text-right"><button class="font-bold" id="btn-endwork" th:data-emp-id="${attend.employee.id}">퇴근하기</button></td>
                    <script th:if="${attend.endAt != null}" defer="defer">
                        document.addEventListener('DOMContentLoaded', function() {
                            const btnEndWork = document.getElementById('btn-endwork');
                            btnEndWork.disabled = true;  // 퇴근 시간이 이미 등록되었으면 버튼 비활성화
                        });
                    </script>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <table>
        <thead>
            <tr>
                <th>날짜</th>
                <th>출근시간</th>
                <th>퇴근시간</th>
                <th>상태</th>
                <th>정정사유</th>
            </tr>
        </thead>
        <tbody>
        <tr th:each="attend, status : ${attends}" th:data-attend-id="${attend.id}">
            <td th:text="${#temporals.format(attend.startAt,'yyyy/MM/dd')}"></td>
            <td th:text="${#temporals.format(attend.startAt,'HH:mm:ss')}"></td>
            <td th:text="${#temporals.format(attend.endAt,'HH:mm:ss')}"></td>
            <td>
            <button id="attendOnTime" th:text="${#temporals.format(attend.startAt, 'yyyy-MM-dd HH:mm:ss')}"
                    data-modal-target="crud-modal" data-modal-toggle="crud-modal"
                    class="block text-white bg-blue-600 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
                    type="button">
            </button>
            </td>
                <script th:inline="javascript">
                document.addEventListener('DOMContentLoaded', function() {
                    const stateElement = document.getElementById('attendOnTime');
                    if (stateElement) {
                        const startAtValue = stateElement.innerHTML;
                        const currentDate = new Date();
                        const compareDate = new Date(startAtValue);
                        let state;

                        if (currentDate.getHours() >= 9) {
                            state = '지각';
                        } else {
                            state = '정상출근';
                        }

                        stateElement.innerText = state;
                    }
                });
            </script>
            <td th:text="${attend.content}"></td>
        </tr>
        <div id="crud-modal"
             tabindex="-1"
             aria-hidden="true"
             class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
            <div class="relative p-4 w-full max-w-2xl max-h-full">
                <!-- Modal content -->
                <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
                    <!-- Modal header -->
                    <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                            정정요청
                        </h3>
                        <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-toggle="crud-modal">
                            <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                            </svg>
                            <span class="sr-only">Close modal</span>
                        </button>
                    </div>

                    <!-- Modal body -->
                    <form name="contentFrm" class="p-4 md:p-5" method="post">
                        <input id="attend-id" name="attendId" th:value="${attend.id}" type="hidden">
                        <div class="grid gap-4 mb-4 grid-cols-2">
                            <div class="col-span-2">
                                <label for="name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">이름</label>
                                <input type="text" name="name" id="name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" readonly required="" th:value="${attend.employee.name}">
                            </div>
                            <div class="col-span-2">
                                <label for="state" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">상태</label>
                                <input type="text" name="state" id="state"
                                       class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                                       readonly th:value="${attend.state.LATE}">
                            </div>
                            <div class="col-span-2">
                                <label for="content" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">정정 사유</label>
                                <textarea id="content" name="content" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Write product description here"></textarea>
                            </div>
                        </div>
                        <!--다른 스타일 버튼-->
                        <div class="p-4 md:p-5 text-center">
                            <button data-modal-hide="crud-modal" id="btnRequest" type="button" class="text-white bg-blue-600 focus:ring-4 focus:outline-none font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5 text-center me-2">
                                요청
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
</div>
        </tbody>
    </table>
    </body>
    </html>


    <script layout:fragment="script" th:src="@{/js/attend/attendList.js}"></script>
</html>